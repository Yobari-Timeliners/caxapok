# GitHub Actions CI/CD Setup

This repository uses GitHub Actions for continuous integration.

## Workflows

### CI Workflow (`.github/workflows/ci.yml`)

Runs automatically on:
- Pushes to `main` or `develop` branches
- Pull requests targeting `main` or `develop` branches

#### Jobs

##### 1. Analyze
- Verifies code formatting (`dart format`)
- Runs static analysis (`dart analyze --fatal-infos`)
- Uses `very_good_analysis` rules from `pubspec.yaml`

##### 2. Test
- Runs all tests with coverage
- Verifies minimum 80% code coverage using [very_good_coverage](https://github.com/VeryGoodOpenSource/very_good_coverage)
- Fails if coverage drops below threshold

##### 3. Pana
- Analyzes package quality using [pana](https://pub.dev/packages/pana)
- Checks pub.dev score and best practices
- Validates package structure and documentation

## Testing Locally

Before pushing code, run the same checks locally:

### Quick Test (Recommended)
```bash
./scripts/run_ci_locally.sh
```

This script runs all CI checks and stops at the first failure.

### Using Act (Docker-based)
```bash
# Install act (macOS)
brew install act

# Run all workflows
act

# Run specific job
act -j analyze
act -j test
act -j pana
```

See [LOCAL_CI_TESTING.md](../LOCAL_CI_TESTING.md) for detailed instructions.

## Requirements

- Dart SDK >=3.10.0
- All dependencies from `pubspec.yaml`
- For local coverage checks: `dart pub global activate coverage`
- For local pana checks: `dart pub global activate pana`

## Coverage Reports

Test coverage data is generated in the `coverage/` directory:
- `coverage/lcov.info` - LCOV format coverage data
- Raw coverage data in `coverage/test/` (generated by dart test)

To view coverage locally:
```bash
# macOS (requires lcov)
brew install lcov
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html
```

## Badge

Add this badge to your README to show CI status:

```markdown
[![CI](https://github.com/Yobari-Timeliners/caxapok/workflows/CI/badge.svg)](https://github.com/Yobari-Timeliners/caxapok/actions)
```

## Troubleshooting

### Formatting Issues
```bash
# Auto-fix formatting
dart format .
```

### Analysis Issues
```bash
# Show all issues
dart analyze

# Show issues with specific severity
dart analyze --fatal-infos
```

### Coverage Below Threshold
Add more tests or adjust the threshold in:
- `.github/workflows/ci.yml` (line with `min_coverage`)
- `scripts/run_ci_locally.sh` (coverage check section)

### Pana Score Issues
Run pana locally to see detailed feedback:
```bash
dart pub global activate pana
dart pub global run pana
```

Common improvements:
- Add LICENSE file
- Add/improve documentation comments
- Add examples in `example/` directory
- Ensure `repository` URL is accessible in `pubspec.yaml`
